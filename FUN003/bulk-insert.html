<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµìœ¡ê³¼ì • ëŒ€ëŸ‰ ë“±ë¡</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: system-ui, -apple-system, sans-serif; background: #f7f8fa; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: #2563eb; color: white; padding: 20px; text-align: center; }
        .header h1 { font-size: 24px; margin: 0; }
        .content { padding: 30px; }
        .info-box { background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; padding: 20px; margin-bottom: 30px; }
        .info-box h3 { color: #2563eb; margin-bottom: 15px; font-size: 18px; }
        .info-box ul { margin: 0; padding-left: 20px; }
        .info-box li { margin-bottom: 8px; color: #374151; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #374151; }
        .form-group input[type="file"] { width: 100%; padding: 12px; border: 2px dashed #d1d5db; border-radius: 8px; background: #f9fafb; cursor: pointer; }
        .form-group input[type="file"]:hover { border-color: #2563eb; background: #f0f9ff; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-right: 10px; }
        .btn-primary { background: #2563eb; color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-secondary:hover { background: #4b5563; }
        .btn-success { background: #059669; color: white; }
        .btn-success:hover { background: #047857; }
        .preview-section { margin-top: 30px; display: none; }
        .preview-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .preview-table th, .preview-table td { padding: 12px; text-align: left; border: 1px solid #e5e7eb; }
        .preview-table th { background: #f3f4f6; font-weight: 600; }
        .preview-table tr:nth-child(even) { background: #f9fafb; }
        .template-section { margin-top: 20px; padding: 20px; background: #f9fafb; border-radius: 8px; }
        .template-section h4 { margin-bottom: 15px; color: #374151; }
        .error { color: #dc2626; background: #fef2f2; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .success { color: #059669; background: #f0fdf4; padding: 15px; border-radius: 8px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š êµìœ¡ê³¼ì • ëŒ€ëŸ‰ ë“±ë¡</h1>
        </div>
        <div class="content">
            <div class="info-box">
                <h3>ğŸ“‹ ë“±ë¡ ì•ˆë‚´</h3>
                <ul>
                    <li>Excel íŒŒì¼(.xlsx)ì„ ì—…ë¡œë“œí•˜ì—¬ ì—¬ëŸ¬ êµìœ¡ê³¼ì •ì„ í•œ ë²ˆì— ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    <li>íŒŒì¼ í˜•ì‹: êµìœ¡ì‚¬ì—…ëª…, ì„¸ë¶€ê³¼ì •(í”„ë¡œê·¸ë¨)ëª…, ì‹œì‘ì¼, ì¢…ë£Œì¼, í•„ìˆ˜ì—¬ë¶€, ì¸ì •ì‹œê°„, êµìœ¡ê¸°ê´€, ë“±ë¡ì ìˆœì„œë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.</li>
                    <li>í•„ìˆ˜ì—¬ë¶€ëŠ” 'í•„ìˆ˜' ë˜ëŠ” 'ì„ íƒ'ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.</li>
                    <li>ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì€ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.</li>
                </ul>
            </div>
            
            <div class="template-section">
                <h4>ğŸ“„ ì—‘ì…€ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</h4>
                <p>ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í…œí”Œë¦¿ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ê³ , ë°ì´í„°ë¥¼ ì…ë ¥í•œ í›„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.</p>
                <button id="downloadTemplate" class="btn btn-success">í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</button>
            </div>
            
            <div class="form-group">
                <label for="excelFileInput">Excel íŒŒì¼ ì„ íƒ</label>
                <input type="file" id="excelFileInput" accept=".xlsx" />
            </div>
            
            <div id="previewSection" class="preview-section">
                <h4>ë¯¸ë¦¬ë³´ê¸°</h4>
                <div id="previewTable"></div>
                <div style="margin-top: 20px;">
                    <button id="confirmInsert" class="btn btn-primary">ë“±ë¡í•˜ê¸°</button>
                    <button id="cancelInsert" class="btn btn-secondary">ì·¨ì†Œ</button>
                </div>
            </div>
            
            <div id="messageArea"></div>
        </div>
    </div>
    
    <script>
        let coursesData = [];
        
        // í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
        document.getElementById('downloadTemplate').addEventListener('click', function() {
            const templateData = [
                ['êµìœ¡ì‚¬ì—…ëª…', 'ì„¸ë¶€ê³¼ì •(í”„ë¡œê·¸ë¨)ëª…', 'ì‹œì‘ì¼', 'ì¢…ë£Œì¼', 'í•„ìˆ˜ì—¬ë¶€', 'ì¸ì •ì‹œê°„', 'êµìœ¡ê¸°ê´€', 'ë“±ë¡ì'],
                ['ì˜ì•½í’ˆ ì•ˆì „ì„± ëª¨ë‹ˆí„°ë§', 'ì˜ì•½í’ˆ ì•ˆì „ì„± ëª¨ë‹ˆí„°ë§ ë° ë¶€ì‘ìš© ê´€ë¦¬ ì‹¤ë¬´', '2025-03-15', '2025-03-20', 'í•„ìˆ˜', '6', 'ì™¸ë¶€ êµìœ¡ê¸°ê´€', 'ê¹€ì•ˆì „'],
                ['ì˜ì•½í’ˆ í’ˆì§ˆê´€ë¦¬ ì „ë¬¸ê°€ ê³¼ì •', 'ì˜ì•½í’ˆ í’ˆì§ˆê´€ë¦¬ ì „ë¬¸ê°€ ì–‘ì„±ì„ ìœ„í•œ ì‹¬í™” ê³¼ì •', '2025-05-01', '2025-05-15', 'ì„ íƒ', '20', 'ì™¸ë¶€ êµìœ¡ê¸°ê´€', 'ì´í’ˆì§ˆ']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(templateData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'êµìœ¡ê³¼ì •');
            
            XLSX.writeFile(wb, 'êµìœ¡ê³¼ì •_ëŒ€ëŸ‰ë“±ë¡_í…œí”Œë¦¿.xlsx');
        });
        
        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        document.getElementById('excelFileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    if (jsonData.length < 2) {
                        showMessage('íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                        return;
                    }
                    
                    // í—¤ë” ì œê±°í•˜ê³  ë°ì´í„° íŒŒì‹±
                    const headers = jsonData[0];
                    coursesData = [];
                    
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row.length >= 6) {
                            coursesData.push({
                                name: row[0] || '',
                                desc: row[1] || '',
                                startDate: row[2] || '',
                                endDate: row[3] || '',
                                type: row[4] || '',
                                hours: parseInt(row[5]) || 0,
                                orgName: row[6] || 'ì™¸ë¶€ êµìœ¡ê¸°ê´€',
                                registrant: row[7] || 'í™ê¸¸ë™'
                            });
                        }
                    }
                    
                    if (coursesData.length > 0) {
                        showPreview();
                    } else {
                        showMessage('ìœ íš¨í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    }
                } catch (error) {
                    showMessage('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
        });
        
        // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        function showPreview() {
            const previewSection = document.getElementById('previewSection');
            const previewTable = document.getElementById('previewTable');
            
                            let tableHtml = '<table class="preview-table">' +
                                '<thead>' +
                                    '<tr>' +
                                        '<th>êµìœ¡ì‚¬ì—…ëª…</th>' +
                                        '<th>ì‹œì‘ì¼</th>' +
                                        '<th>ì¢…ë£Œì¼</th>' +
                                        '<th>í•„ìˆ˜ì—¬ë¶€</th>' +
                                        '<th>ì¸ì •ì‹œê°„</th>' +
                                        '<th>êµìœ¡ê¸°ê´€</th>' +
                                    '</tr>' +
                                '</thead>' +
                                '<tbody>';
            
            coursesData.forEach(function(course, index) {
                tableHtml += '<tr>' +
                    '<td>' + course.name + '</td>' +
                    '<td>' + course.startDate + '</td>' +
                    '<td>' + course.endDate + '</td>' +
                    '<td>' + course.type + '</td>' +
                    '<td>' + course.hours + 'ì‹œê°„</td>' +
                    '<td>' + course.orgName + '</td>' +
                    '</tr>';
            });
            
            tableHtml += '</tbody></table>';
            previewTable.innerHTML = tableHtml;
            previewSection.style.display = 'block';
            
            showMessage(coursesData.length + 'ê°œì˜ êµìœ¡ê³¼ì •ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤. ë¯¸ë¦¬ë³´ê¸°ë¥¼ í™•ì¸í•˜ê³  ë“±ë¡í•´ì£¼ì„¸ìš”.', 'success');
        }
        
        // ë“±ë¡ í™•ì¸
        document.getElementById('confirmInsert').addEventListener('click', function() {
            if (coursesData.length === 0) {
                showMessage('ë“±ë¡í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            // ë¶€ëª¨ ì°½ì— ë°ì´í„° ì „ë‹¬
            window.opener.postMessage({
                type: 'bulkInsertCourses',
                data: coursesData
            }, '*');
            
            showMessage('êµìœ¡ê³¼ì •ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            
            setTimeout(function() {
                window.close();
            }, 2000);
        });
        
        // ì·¨ì†Œ
        document.getElementById('cancelInsert').addEventListener('click', function() {
            window.close();
        });
        
        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type) {
            const messageArea = document.getElementById('messageArea');
            messageArea.innerHTML = '<div class="' + type + '">' + message + '</div>';
        }
    </script>
</body>
</html>
